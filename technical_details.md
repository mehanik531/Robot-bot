# Технические детали реализации системы навигации

## Введение

Этот раздел содержит подробное описание архитектуры системы навигации для автономного робота. В нем представлены основные компоненты системы, структуры данных, используемые библиотеки, а также поясняется логика работы системы.

---

## 1. Основные компоненты системы

Система навигации включает следующие основные компоненты:

### 1.1. Генератор карты

Компонент отвечает за создание двумерной карты пространства, которая представляет собой матрицу. Каждая клетка этой матрицы может быть либо свободной (0), либо занята препятствием (1). Этот компонент позволяет случайно генерировать карту на основе заданных параметров (высота, ширина и вероятность появления препятствий).

#### Пример генерации карты:
```python
def generate_map(height: int, width: int, wall_chance: float) -> np.ndarray:
    # Генерация случайной карты с заданными параметрами
    return np.random.choice([0, 1], size=(height, width), p=[1 - wall_chance, wall_chance])
```
# Технические детали реализации системы навигации

## Алгоритм поиска пути A*

Алгоритм A* (A-star) используется для поиска кратчайшего пути между двумя точками на карте. Этот алгоритм сочетает элементы поиска по графу и эвристической оценки (манхэттенское расстояние) для нахождения оптимального пути. Он использует приоритетную очередь для отслеживания наиболее перспективных узлов.

### Пример функции поиска пути:

```python
def find_path(robo_map: np.ndarray, start: Tuple[int, int], target: Tuple[int, int]) -> List[Tuple[int, int]]:
    # Реализация алгоритма A* для поиска кратчайшего пути
    pass
```
Оптимизатор пути
Этот компонент отвечает за оптимизацию найденного пути. Основная задача — минимизировать количество поворотов и сделать путь более прямолинейным. Этот компонент можно рассматривать как улучшение базового алгоритма A*, чтобы робот мог быстрее добраться до цели, совершая меньше маневров.

Пример оптимизации пути:
```python
def optimize_path(path: List[Tuple[int, int]]) -> List[Tuple[int, int]]:
    # Оптимизация маршрута для уменьшения количества поворотов
    pass
```
Визуализатор
Компонент визуализации отвечает за графическое отображение карты и маршрута. Визуализатор отображает карту как изображение, где препятствия и свободные клетки показаны разными цветами, а найденный путь робота выделен красной линией.

Пример визуализации:
```python
import matplotlib.pyplot as plt

def visualize_map_and_path(mappy: np.ndarray, path: List[Tuple[int, int]]) -> None:
    plt.imshow(mappy, cmap='binary')
    if path:
        path_array = np.array(path)
        plt.plot(path_array[:, 1], path_array[:, 0], color='red')
    plt.show()
```
## Структуры данных
### Карта (Map)
Карта пространства представлена как двумерный массив (матрица), где каждая ячейка имеет одно из двух возможных значений:

0 — свободное пространство, через которое робот может пройти.
1 — препятствие, которое блокирует путь.
Пример карты:
```python
robo_map = np.array([
    [0, 0, 1, 0],
    [0, 1, 1, 0],
    [0, 0, 0, 0],
    [1, 1, 0, 0]
])
```
Очередь с приоритетом (Priority Queue)
Очередь с приоритетом используется в алгоритме A* для того, чтобы всегда обрабатывать узлы с наименьшей стоимостью пути. Это важный элемент, который ускоряет поиск кратчайшего пути.

Пример использования очереди:
```python
import heapq

queue = []
heapq.heappush(queue, (0, (0, 0)))  # Добавляем узел с приоритетом 0
current = heapq.heappop(queue)  # Извлекаем узел с наименьшим приоритетом
```
## Эвристика
Алгоритм A* использует эвристическую функцию для оценки "стоимости" движения из текущей точки к целевой. В данном случае применяется манхэттенское расстояние, которое вычисляется как сумма абсолютных разностей координат по осям X и Y.

Пример вычисления манхэттенского расстояния:
```python
def heuristic(p1: Tuple[int, int], p2: Tuple[int, int]) -> int:
    return abs(p1[0] - p2[0]) + abs(p1[1] - p2[1])
```
Используемые библиотеки
NumPy — это библиотека для работы с многомерными массивами. В данной системе она используется для генерации и работы с картой пространства.

Установка:
```python
pip install numpy
```

Matplotlib — библиотека для визуализации данных. В нашей системе она применяется для отображения карты и найденного пути робота.

Установка:
```python
pip install matplotlib
```
Heapq — встроенная библиотека Python, которая используется для работы с очередями с приоритетом в алгоритме A*. Она позволяет эффективно извлекать элементы с минимальной стоимостью пути.

Пример :
```python
import heapq
````

# Очередь для обработки узлов с приоритетом
```python
to_be_processed = []
heapq.heappush(to_be_processed, (0, (0, 0)))
```
Общая логика работы системы
1. Генерация карты
На этапе генерации создается случайная карта с заданной высотой, шириной и вероятностью появления препятствий. Карта передается в алгоритм поиска пути.

2. Поиск пути
Алгоритм A* начинает поиск от начальной точки и оценивает соседние клетки. Если найдена более короткая траектория, алгоритм обновляет стоимость пути и добавляет узел в очередь с приоритетом.

3. Оптимизация пути
После нахождения базового маршрута выполняется оптимизация для сокращения лишних поворотов и улучшения маршрута.

4. Визуализация
Наконец, система визуализирует карту и найденный маршрут, чтобы пользователь мог наглядно увидеть результат работы алгоритма.